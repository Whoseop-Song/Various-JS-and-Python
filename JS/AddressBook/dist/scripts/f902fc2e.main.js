!function(){window.app={},app.models={},app.views={}}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m={}.hasOwnProperty,n=function(a,b){function c(){this.constructor=a}for(var d in b)m.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};if(a=function(a){function b(){return g=b.__super__.constructor.apply(this,arguments)}return n(b,a),b.prototype.mandatory=[],b.prototype.validate=function(a){var b,c,d,e;return b=function(){var b,c,e,f;for(e=this.mandatory,f=[],b=0,c=e.length;c>b;b++)d=e[b],a[d]||f.push(d);return f}.call(this),b.length?(c=_.map(b,_.capitalize).join(", "),e=b.length>1?"are":"is",[b,""+c+" "+e+" mandatory"]):void 0},b}(Backbone.Model),app.models.Group=function(a){function b(){return h=b.__super__.constructor.apply(this,arguments)}return n(b,a),b.prototype.defaults={name:""},b.prototype.mandatory=["name"],b}(a),app.models.Contact=function(a){function b(){return i=b.__super__.constructor.apply(this,arguments)}return n(b,a),b.prototype.defaults={name:"",phone:"",groupId:null},b.prototype.mandatory=["name","phone"],b}(a),b=function(a){function b(){return j=b.__super__.constructor.apply(this,arguments)}return n(b,a),b.prototype.model=app.models.Contact,b.prototype.localStorage=new Backbone.LocalStorage("ContactsCollection"),b.prototype.comparator=function(a){return a.get("name")},b}(Backbone.Collection),c=function(a){function b(){return k=b.__super__.constructor.apply(this,arguments)}return n(b,a),b.prototype.model=app.models.Group,b.prototype.localStorage=new Backbone.LocalStorage("GroupCollection"),b.prototype.makeOptions=function(a){return this.map(function(b){var c,d;return c=b.id||b.cid,d=c===a?"selected":"","<option value='"+c+"' "+d+">"+b.escape("name")+"</option>"}).join("")},b}(Backbone.Collection),app.models.contacts=new b,app.models.groups=new c,app.models.groups.fetch(),0===app.models.groups.length)for(l=["Work","Family","Other"],e=0,f=l.length;f>e;e++)d=l[e],app.models.groups.create({name:d})}.call(this),function(){var a,b,c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};app.views.SearchForm=function(b){function c(){return a=c.__super__.constructor.apply(this,arguments)}return f(c,b),c.prototype.el="#top-form",c.prototype.events={"keyup #search-add-field":"search"},c.prototype.initialize=function(){return this.$query=$("#search-add-field"),this.$searchAddIcon=this.$("label[for=search-add-field] i")},c.prototype.render=function(){return this.$query.attr("placeholder","Search contact"),this.$searchAddIcon.removeAttr("class").addClass("icon-search"),this.$el.removeClass("add-form-state"),this.$(".has-error").removeClass("has-error"),app.mainPage.closeError(),this.$query.val("").focus(),this.$(".second-row").slideUp("fast")},c.prototype.search=function(){var a;return a=0===this.$(".second-row:visible").length,a?app.mainPage.filter(this.$query.val()):void 0},c}(Backbone.View),app.views.AddForm=function(a){function c(){return b=c.__super__.constructor.apply(this,arguments)}return f(c,a),c.prototype.el="#top-form",c.prototype.events={"click button.cancel":"clear","click button.save":"save","keyup input":"clearErorrs"},c.prototype.initialize=function(){return _.bindAll(this,"renderGroups","resetModel"),this.$name=$("#search-add-field"),this.$phone=$("#phone-field"),this.$group=$("#group-field"),this.$searchAddIcon=this.$("label[for=search-add-field] i"),app.models.contacts.on("reset",this.resetModel),app.models.groups.on("all",this.renderGroups)},c.prototype.renderGroups=function(){return this.$group.html(app.models.groups.makeOptions())},c.prototype.resetModel=function(){var a=this;return this.clear(),this.model=new app.models.Contact,app.models.contacts.add(this.model),this.model.on("invalid",function(){var b,c,d,e,f,g;for(g=a.model.validationError,c=g[0],d=g[1],e=0,f=c.length;f>e;e++)b=c[e],a.$("[data-field="+b+"]").parent().addClass("has-error");return app.mainPage.showError(d)},this)},c.prototype.clear=function(){return this.$name.val(""),this.$phone.val("")},c.prototype.clearErorrs=function(a){return $(a.target).parents(".has-error").removeClass("has-error"),app.mainPage.closeError()},c.prototype.save=function(){var a=this;return this.model.save({name:this.$name.val(),phone:this.$phone.val(),groupId:this.$group.val()},{success:function(){return a.model.off(null,null,a),a.trigger("done"),a.resetModel()}})},c.prototype.render=function(){return this.$name.attr("placeholder","Full name"),this.$searchAddIcon.removeAttr("class").addClass("icon-user"),this.$el.addClass("add-form-state"),this.$(".has-error").removeClass("has-error"),app.mainPage.closeError(),this.$name.focus(),this.renderGroups(),this.$(".second-row").slideDown("fast"),this.$group.selectpicker({container:"body"}).selectpicker("setStyle","form-control btn-lg input-lg group-select-ui")},c}(Backbone.View),app.views.ContactsListView=function(a){function b(){return c=b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.el="#contacts-list",b.prototype.events={"click .row .col":"editMode","click .row .edit":"editMode","click .row .save":"saveRow","click .row .cancel":"cancelRow","click .row .delete":"clickDelete","keyup .row input":"keyPress"},b.prototype.collection=app.models.contacts,b.prototype.template=_.template($("#contact-list-item").html()),b.prototype.initialize=function(){return _.bindAll(this,"renderAll","renderOne","deleteOne","changeOne"),this.collection.on("reset add",this.renderAll),this.collection.on("destroy",this.deleteOne),this.collection.on("change",this.changeOne),this.collection.fetch({reset:!0})},b.prototype.deleteOne=function(a){var b;return b=$("#contact-"+a.id),b.slideUp("fast"),setTimeout(function(){return b.remove()},1e3)},b.prototype.changeOne=function(a){var b;return b=$("#contact-"+a.id),b.length?(b.replaceWith(this.renderOne(a)),this.updateSelects()):this.renderAll()},b.prototype.getRow=function(a){return $(a.currentTarget).parents(".row:eq(0)")},b.prototype.getContactOnEvent=function(a){var b,c;return b=this.getRow(a),c=b.data("id"),this.collection.get(c)},b.prototype.keyPress=function(a){return 13===a.keyCode?this.saveRow(a):void 0},b.prototype.editMode=function(a){var b;return b=this.getRow(a),b.is(".edit-mode")?void 0:(this.cancelAllRows(),b.addClass("edit-mode"),$(a.currentTarget).closest(".col").find("input, button.dropdown-toggle").focus().select())},b.prototype.cancelAllRows=function(){return $(".row").removeClass("edit-mode")},b.prototype.cancelRow=function(a){var b;return b=this.getRow(a),b.removeClass("edit-mode")},b.prototype.clickDelete=function(a){return this.getContactOnEvent(a).destroy()},b.prototype.saveRow=function(a){var b,c;return b=this.getRow(a),c=this.getContactOnEvent(a),c.save({name:b.find(".js-name input").val(),phone:b.find(".js-phone input").val(),groupId:b.find(".js-group select").val()})},b.prototype.renderOne=function(a){var b;if(!a.isNew())return b=_.clone(a.attributes),b.groupName=app.models.groups.get(b.groupId).get("name"),b.id=a.id||a.cid,b.groups=app.models.groups.makeOptions(a.get("groupId")),this.template(b)},b.prototype.renderAll=function(){return this.$el.html(this.collection.map(this.renderOne).join("")),this.updateSelects()},b.prototype.updateSelects=function(){return this.$(".col.js-group select").selectpicker({container:"body"}).selectpicker("setStyle","form-control group-select-ui")},b.prototype.filterOut=function(a){var b,c,d,e=this;return this.query=_.trim(a.toLowerCase()),b=this.$el.find(".row").show(),this.query?(d=this.collection.filter(function(a){var b,c,d,f,g;for(g=e.query.split(" "),d=0,f=g.length;f>d;d++)if(c=g[d],b=_.str.include(a.get("name").toLowerCase(),c)||_.str.include(a.get("phone").toLowerCase(),c))return!1;return!0}),c=_.map(d,function(a){return"#contact-"+a.id}).join(", "),b.filter(c).hide()):void 0},b.prototype.render=function(){return this.collection.length>0?this.renderAll():this.$el.html("<span class='no-data'>There is no contacts yet. <strong>Add one!</strong></span>")},b}(Backbone.View),app.views.MainPage=function(a){function b(){return d=b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.el="#main-page-content",b.prototype.errorTemplate=_.template($("#error-message-box").html()),b.prototype.events=function(){var a=this;return{"click #top-form button.cancel":function(){return a.searchForm.render()},"click #top-form button.add-one":function(){return a.addForm.render()}}},b.prototype.initialize=function(){var a=this;return this.addForm=new app.views.AddForm,this.addForm.on("done",function(){return a.searchForm.render()}),this.searchForm=new app.views.SearchForm,this.contactsListView=new app.views.ContactsListView},b.prototype.render=function(){return this.$(".alert").alert(),this.searchForm.render(),this.contactsListView.render()},b.prototype.showError=function(a){return $("#alerts-box").html(this.errorTemplate({message:a}))},b.prototype.closeError=function(){return this.$("button.close").click()},b.prototype.filter=function(a){return this.contactsListView.filterOut(a)},b}(Backbone.View)}.call(this),function(){_.mixin(_.str.exports()),app.searchQuery="",app.mainPage=new app.views.MainPage,app.mainPage.render()}.call(this);