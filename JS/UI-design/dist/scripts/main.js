(function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.routes={"":"index",login:"login",registration:"registration",search:"search","my-shelf":"myShelf","modal-info/:id":"showModelInfo"},e.prototype.initialize=function(){},e.prototype.index=function(){return this.name?this.navigate("search",{trigger:!0}):this.navigate("login",{trigger:!0}),!1},e.prototype.login=function(){return this.mainView.showLogin()},e.prototype.registration=function(){return this.mainView.showRegistration()},e.prototype.search=function(){return this.mainView.showSearch()},e.prototype.myShelf=function(){return this.mainView.showMyShelf()},e.prototype.showModelInfo=function(t){return this.myShelf(),this.mainView.myShelfView.showModelInfo(t)},e.prototype.setName=function(t){return this.name=t,$("#userNamePlace").text(this.name)},e.prototype.start=function(){return this.mainView=new this.MainView,Backbone.history.start({pushState:!0}),app.myBooks.fetch(),$("body").on("click","a",function(t){var e;return e=$(this).attr("href"),0!==e.indexOf("http")&&"#"!==e?(t.preventDefault(),app.navigate(e,{trigger:!0})):!0}),this},e}(Backbone.Router),window.app=new t,$(function(){return app.start()})}).call(this),function(){app.GoogleApi=function(){function t(t){this.perPage=null!=t?t:20,this.key="AIzaSyBh4CXjrAS1zFJPO_2KWTG5HavZnDjhjkQ"}return t.prototype.search=function(t,e,n){var r;return n||(n=e,e={}),e=$.extend({page:1},e),r=["id","volumeInfo/title","volumeInfo/subtitle","volumeInfo/authors","volumeInfo/description","volumeInfo/publisher","volumeInfo/publishedDate","volumeInfo/imageLinks","volumeInfo/categories","volumeInfo/mainCategory","volumeInfo/averageRating","volumeInfo/ratingsCount","volumeInfo/language","volumeInfo/industryIdentifiers","volumeInfo/imageLinks"].join(","),$.ajax({url:"https://www.googleapis.com/books/v1/volumes",data:{key:this.key,q:t,country:"us",startIndex:(e.page-1)*this.perPage,maxResults:this.perPage,callback:"callback",fields:"items("+r+"),totalItems"},dataType:"jsonp",error:function(){return console.log("Error",arguments)},success:n})},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};app.Book=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.parseGoogle=function(t){var e,n,r;return e=t.volumeInfo,{id:t.id,title:e.title,subtitle:e.subtitle,authors:e.authors,authorsStr:(e.authors||["unknown author"]).join(", "),description:e.description,averageRating:e.averageRating,ratingsCount:e.ratingsCount,categories:e.categories,image:null!=(n=e.imageLinks)?n.thumbnail:void 0,ISBN:null!=(r=e.industryIdentifiers[1])?r.identifier:void 0,language:e.language,publishedDate:Date.parse(e.publishedDate),publisher:e.publisher}},n.prototype.defaults={borrowedBy:!1,borrowedDate:null,title:null,subtitle:null,authors:null,authorsStr:null,description:null,averageRating:null,ratingsCount:null,categories:null,image:null,ISBN:null,language:null,publishedDate:null,publisher:null},n}(Backbone.Model),app.GoogleBooksCollection=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=app.Book,n.prototype.initialize=function(){return this.gapi=new app.GoogleApi},n.prototype.search=function(t){var e=this;return this.q=t,this.page=1,this.gapi.search(this.q,function(t){return e.total=t.totalItems,t=t.items.map(function(t){return app.Book.parseGoogle(t)}),e.reset(t)})},n.prototype.searchMore=function(){var t=this;return this.page+=1,this.gapi.search(this.q,{page:this.page},function(e){return e=e.items.map(function(t){return app.Book.parseGoogle(t)}),t.add(e)})},n.prototype.sync=function(){},n}(Backbone.Collection),app.MyBooksCollection=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=app.Book,n.prototype.localStorage=new Backbone.LocalStorage("MyShelf"),n}(Backbone.Collection),app.googleBooks=new app.GoogleBooksCollection,app.myBooks=new app.MyBooksCollection}.call(this),function(){var t,e,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};app.SearchView=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.el="#search",e.prototype.events={"keypress input.search-query":"doSearch","click #loadMore":"moreSearch","click button.add":"toMyShelf","click button.remove":"fromMyShelf","click #showSearchOptions":"toggleSearchOptions"},e.prototype.bookTemplate=_.template($("#bookTemplate").html()),e.prototype.initialize=function(){return _.bindAll(this,"addAllBooks","addOneBook","updateMyBook"),this.input=this.$(".search-query"),this.resultContainer=this.$("#search-results"),this.resultList=this.resultContainer.find(".list"),app.googleBooks.on("reset",this.addAllBooks),app.googleBooks.on("add",this.addOneBook),app.myBooks.on("add remove destroy",this.updateMyBook)},e.prototype.toggleSearchOptions=function(){return this.$(".search-options > div").toggle()},e.prototype.doSearch=function(t){return 13===t.keyCode&&this.input.val()?(this.preloader(!0),app.googleBooks.search(this.input.val())):void 0},e.prototype.moreSearch=function(){return this.preloader(!0),app.googleBooks.searchMore()},e.prototype.updateCounter=function(){return this.$(".found-count").html("Found "+app.googleBooks.total+" results. First "+app.googleBooks.length+" shown below.")},e.prototype.addOneBook=function(t){return this.resultList.append(this.bookTemplate(t.attributes)),$(".stars span").tooltip(),this.updateCounter(),this.preloader(!1)},e.prototype.addAllBooks=function(){return this.resultList.empty(),app.googleBooks.length>0&&$("#loadMore").show(),app.googleBooks.each(this.addOneBook)},e.prototype.preloader=function(t){return this.$(".form-search").toggleClass("preloader",t)},e.prototype.toMyShelf=function(t){var e;return e=app.googleBooks.get($(t.target).data("id")),app.myBooks.create(e.attributes)},e.prototype.fromMyShelf=function(t){var e;return e=app.myBooks.get($(t.target).data("id")),e.destroy()},e.prototype.updateMyBook=function(t){var e,n;return e=t.id,n=null!=app.myBooks.get(e),this.$("#book_"+e).toggleClass("onMyShelf",n)},e.prototype.render=function(){return this.addAllBooks(),this.$el.show()},e}(Backbone.View),app.MyShelfView=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.el="#my-shelf",e.prototype.events={"click button.remove":"removeBook","click button.give-away":"giveAwayBook","click button.submit-give-away":"submitGiveAwayBook","click button.cancel-give-away":"cancelGiveAwayBook","click button.take-back":"takeBackBook","keyup input.borrower-name":"keyup"},e.prototype.template=_.template($("#myShelfBookTemplate").html()),e.prototype.infoTemplate=_.template($("#bookTemplate").html()),e.prototype.initialize=function(){return _.bindAll(this,"addOneBook","addAllBooks","removeFromDOM","giveAwayBook","updateBook"),this.tableBody=this.$("table tbody"),app.myBooks.on("reset",this.addAllBooks),app.myBooks.on("add",this.addOneBook),app.myBooks.on("change",this.updateBook),app.myBooks.on("remove destroy",this.removeFromDOM)},e.prototype.modelFromEvent=function(t){return app.myBooks.get($(t.target).data("id"))},e.prototype.rowFromEvent=function(t){var e;return e=$(t.target).data("id"),$("#my_book_"+e)},e.prototype.keyup=function(t){return 13===t.keyCode?this.rowFromEvent(t).find("button.submit-give-away").click():void 0},e.prototype.giveAwayBook=function(t){var e;return e=this.rowFromEvent(t),e.find(".default-section").hide(),e.find(".submit-section").show(),e.find(".borrower-name-container").slideDown("fast"),e.find(".borrower-name").focus()},e.prototype.submitGiveAwayBook=function(t){var e,n,r=this;return n=this.rowFromEvent(t),e=n.find("input.borrower-name").val(),n.find(".borrower-name-container").slideUp("fast",function(){return r.modelFromEvent(t).set({borrowedBy:e,borrowedDate:(new Date).toString("yyyy-MM-ddTHH:mm:ssZ")}).save()})},e.prototype.cancelGiveAwayBook=function(t){var e=this;return this.rowFromEvent(t).find(".borrower-name-container").slideUp("fast",function(){return e.updateBook(e.modelFromEvent(t))})},e.prototype.takeBackBook=function(t){return this.modelFromEvent(t).set("borrowedBy",!1).save()},e.prototype.removeBook=function(t){return confirm("Are you sure want delete it?")?this.modelFromEvent(t).destroy():void 0},e.prototype.removeFromDOM=function(t){var e;return e=t.get("id"),$("#my_book_"+e).remove(),0===app.myBooks.length?this.$("tr.no-books").show():void 0},e.prototype.updateBook=function(t){var e;return e=t.get("id"),$("#my_book_"+e).replaceWith(this.template(t.attributes))},e.prototype.addOneBook=function(t){return this.tableBody.append(this.template(t.attributes)),this.$("tr.no-books").hide()},e.prototype.addAllBooks=function(){return this.tableBody.find("tr:not(.no-books)").remove(),0===app.myBooks.length&&this.$("tr.no-books").show(),app.myBooks.each(this.addOneBook)},e.prototype.showModelInfo=function(t){var e,n=this;return e=function(){var e,r;return e=app.myBooks.get(t).attributes,r=$("#modalInfo"),$(".modal-body",r).html(n.infoTemplate(e)),$("#modalInfoTitle").html(e.title).next("p").html(e.authorsStr),$(".titlePart",r).remove(),$("button.add, button.remove",r).remove(),r.modal(),r.on("hide",function(){return app.navigate("my-shelf",{trigger:!0})})},app.myBooks.length>0?e():app.myBooks.once("fetch reset",function(){return e()})},e.prototype.render=function(){return this.addAllBooks(),this.$el.show()},e}(Backbone.View),t=function(t,e){var n;return n=t.parents(".control-group"),n.addClass("error"),t.after($("<span>").addClass("help-inline").text(e)),!1},e=function(t,e){return t.find("h1").after($("<div>").addClass("alert alert-error").text(e))},app.LoginView=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return r(i,n),i.prototype.el="#login",i.prototype.usersList={"soswow@gmail.com":["kala1","Aleksandr"]},i.prototype.events={"submit form":"submit"},i.prototype.initialize=function(){return this.emailEl=$("input[name=inputEmail]"),this.passwordEl=$("input[name=inputPassword]")},i.prototype.clearErrors=function(){return this.$(".alert.alert-error").remove(),this.$(".control-group.error  .help-inline").remove(),this.$(".control-group").removeClass("error")},i.prototype.validate=function(){return this.emailEl.val()?this.passwordEl.val()?this.emailEl.val().search(false)?!0:t(this.emailEl,"Invalid email"):t(this.passwordEl,"Is required"):t(this.emailEl,"Is required")},i.prototype.submit=function(t){var n,r;if(t.preventDefault(),this.clearErrors(),this.validate()){if((null!=(n=this.usersList[this.emailEl.val()])?n[0]:void 0)!==this.passwordEl.val())return e(this.$el,"Wrong username or/and password");app.setName(null!=(r=this.usersList[this.emailEl.val()])?r[1]:void 0),app.navigate("search",{trigger:!0})}return!1},i.prototype.render=function(){return this.$el.show()},i}(Backbone.View),app.RegistrationView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,e),n.prototype.el="#registration",n.prototype.events={"submit form":"submit"},n.prototype.initialize=function(){return this.emailEl=$("#registerEmail"),this.passwordEl=$("#registerPassword"),this.nameEl=$("#fullName")},n.prototype.clearErrors=function(){return this.$(".control-group.error  .help-inline").remove(),this.$(".control-group").removeClass("error")},n.prototype.validate=function(){return this.emailEl.val()?this.passwordEl.val()?this.emailEl.val().search(false)?!0:t(this.emailEl,"Invalid email"):t(this.passwordEl,"Is required"):t(this.emailEl,"Is required")},n.prototype.submit=function(t){return t.preventDefault(),this.clearErrors(),this.validate()&&(app.setName(this.nameEl.val()||this.emailEl.val()),app.navigate("search",{trigger:!0})),!1},n.prototype.render=function(){return this.$el.show()},n}(Backbone.View),app.MainView=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.el="body",e.prototype.events={"click .nav .search":"navigateLink","click .nav .my-shelf":"navigateLink"},e.prototype.initialize=function(){return _.bindAll(this,"updateMyBooksCount"),this.mainMenu=this.$el.find(".navbar:eq(0)"),this.searchView=new app.SearchView,this.myShelfView=new app.MyShelfView,this.loginView=new app.LoginView,this.registrationView=new app.RegistrationView,app.myBooks.on("add remove destroy fetch reset",this.updateMyBooksCount)},e.prototype.updateMyBooksCount=function(){return $("#myBooksCount").html(app.myBooks.length)},e.prototype.navigateLink=function(t){var e;return e=$(t.target).closest("a").attr("href"),app.navigate(e,{trigger:!0}),!1},e.prototype.activateMenu=function(t){return this.mainMenu.show().find(".nav li").removeClass("active").filter("."+t).addClass("active")},e.prototype.hideContent=function(){return this.$el.find(".content").hide()},e.prototype.showSearch=function(){return this.activateMenu("search"),this.hideContent(),this.searchView.render()},e.prototype.showMyShelf=function(){return this.activateMenu("my-shelf"),this.hideContent(),this.myShelfView.render()},e.prototype.showLogin=function(){return this.mainMenu.hide(),this.hideContent(),this.loginView.render()},e.prototype.showRegistration=function(){return this.mainMenu.hide(),this.hideContent(),this.registrationView.render()},e}(Backbone.View)}.call(this);